<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Understanding the Execution Pipeline &#8212; bisa  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="What’s Up With Mixins, Anyway?" href="mixins.html" />
    <link rel="prev" title="Gotchas when using bisa" href="gotchas.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="understanding-the-execution-pipeline">
<h1>Understanding the Execution Pipeline<a class="headerlink" href="#understanding-the-execution-pipeline" title="Link to this heading">¶</a></h1>
<p>If you’ve made it this far you know that at its core, bisa is a highly flexible
and intensely instrumentable emulator. In order to get the most mileage out of
it, you’ll want to know what happens at every step of the way when you say
<code class="docutils literal notranslate"><span class="pre">simgr.run()</span></code>.</p>
<p>This is intended to be a more advanced document; you’ll need to understand the
function and intent of <code class="docutils literal notranslate"><span class="pre">SimulationManager</span></code>, <code class="docutils literal notranslate"><span class="pre">ExplorationTechnique</span></code>,
<code class="docutils literal notranslate"><span class="pre">SimState</span></code>, and <code class="docutils literal notranslate"><span class="pre">SimEngine</span></code> in order to understand what we’re talking about
at times! You may want to have the bisa source open to follow along with this.</p>
<p>At every step along the way, each function will take <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> and pass them
along to the next function in the hierarchy, so you can pass parameters to any
point in the hierarchy and they will trickle down to everything below.</p>
<section id="simulation-managers">
<h2>Simulation Managers<a class="headerlink" href="#simulation-managers" title="Link to this heading">¶</a></h2>
<p>So you’ve set your analysis in motion. Time to begin our journey.</p>
<section id="run">
<h3><code class="docutils literal notranslate"><span class="pre">run()</span></code><a class="headerlink" href="#run" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">SimulationManager.run()</span></code> takes several optional parameters, all of which
control when to break out of the stepping loop. Notably, <code class="docutils literal notranslate"><span class="pre">n</span></code>, and <code class="docutils literal notranslate"><span class="pre">until</span></code>.
<code class="docutils literal notranslate"><span class="pre">n</span></code> is used immediately - the run function loops, calling the <code class="docutils literal notranslate"><span class="pre">step()</span></code>
function and passing on all its parameters until either <code class="docutils literal notranslate"><span class="pre">n</span></code> steps have
happened or some other termination condition has occurred. If <code class="docutils literal notranslate"><span class="pre">n</span></code> is not
provided, it defaults to 1, unless an <code class="docutils literal notranslate"><span class="pre">until</span></code> function is provided, in which
case there will be no numerical cap on the loop. Additionally, the stash that is
being used is taken into consideration, as if it becomes empty execution must
terminate.</p>
<p>So, in summary, when you call <code class="docutils literal notranslate"><span class="pre">run()</span></code>, <code class="docutils literal notranslate"><span class="pre">step()</span></code> will be called in a loop
until any of the following:</p>
<ol class="arabic simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">n</span></code> number of steps have elapsed</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">until</span></code> function returns true</p></li>
<li><p>The exploration techniques <code class="docutils literal notranslate"><span class="pre">complete()</span></code> hooks (combined via the
<code class="docutils literal notranslate"><span class="pre">SimulationManager.completion_mode</span></code> parameter/attribute - it is by default
the <code class="docutils literal notranslate"><span class="pre">any</span></code> builtin function but can be changed to <code class="docutils literal notranslate"><span class="pre">all</span></code> for example)
indicate that the analysis is complete</p></li>
<li><p>The stash being executed becomes empty</p></li>
</ol>
<section id="an-aside-explore">
<h4>An aside: <code class="docutils literal notranslate"><span class="pre">explore()</span></code><a class="headerlink" href="#an-aside-explore" title="Link to this heading">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">SimulationManager.explore()</span></code> is a very thin wrapper around <code class="docutils literal notranslate"><span class="pre">run()</span></code> which
adds the <code class="docutils literal notranslate"><span class="pre">Explorer</span></code> exploration technique, since performing one-off
explorations is a very common action. Its code in its entirety is below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">num_find</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stashes</span><span class="p">[</span><span class="n">find_stash</span><span class="p">])</span> <span class="k">if</span> <span class="n">find_stash</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stashes</span> <span class="k">else</span> <span class="mi">0</span>
<span class="n">tech</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_technique</span><span class="p">(</span><span class="n">Explorer</span><span class="p">(</span><span class="n">find</span><span class="p">,</span> <span class="n">avoid</span><span class="p">,</span> <span class="n">find_stash</span><span class="p">,</span> <span class="n">avoid_stash</span><span class="p">,</span> <span class="n">cfg</span><span class="p">,</span> <span class="n">num_find</span><span class="p">))</span>

<span class="k">try</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">stash</span><span class="o">=</span><span class="n">stash</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">remove_technique</span><span class="p">(</span><span class="n">tech</span><span class="p">)</span>

<span class="k">return</span> <span class="bp">self</span>
</pre></div>
</div>
</section>
</section>
<section id="exploration-technique-hooking">
<h3>Exploration technique hooking<a class="headerlink" href="#exploration-technique-hooking" title="Link to this heading">¶</a></h3>
<p>From here down, every function in the simulation manager can be instrumented by
an exploration technique. The exact mechanism through which this works is that
when you call <code class="docutils literal notranslate"><span class="pre">SimulationManager.use_technique()</span></code>, bisa monkeypatches the
simulation manager to replace any function implemented in the exploration
technique’s body with a function which will first call the exploration
technique’s function, and then on the second call will call the original
function. This is somewhat messy to implement and certainly not thread safe by
any means, but does produce a clean and powerful interface for exploration
techniques to instrument stepping behavior, either before or after the original
function is called, even choosing whether or not to call the original function
whatsoever. Additionally, it allows multiple exploration techniques to hook the
same function, as the monkeypatched function simply becomes the “original”
function for the next-applied hook.</p>
</section>
<section id="step">
<h3><code class="docutils literal notranslate"><span class="pre">step()</span></code><a class="headerlink" href="#step" title="Link to this heading">¶</a></h3>
<p>There is a lot of complicated logic in <code class="docutils literal notranslate"><span class="pre">step()</span></code> to handle degenerate cases -
mostly implementing the population of the <code class="docutils literal notranslate"><span class="pre">deadended</span></code> stash, the
<code class="docutils literal notranslate"><span class="pre">save_unsat</span></code> option, and calling the <code class="docutils literal notranslate"><span class="pre">filter()</span></code> exploration technique hooks.
Beyond this, though, most of the logic is looping through the stash specified by
the <code class="docutils literal notranslate"><span class="pre">stash</span></code> argument and calling <code class="docutils literal notranslate"><span class="pre">step_state()</span></code> on each state, then applying
the dict result of <code class="docutils literal notranslate"><span class="pre">step_state()</span></code> to the stash list. Finally, if the
<code class="docutils literal notranslate"><span class="pre">step_func</span></code> parameter is provided, it is called with the simulation manager as
a parameter before the step ends.</p>
</section>
<section id="step-state">
<h3><code class="docutils literal notranslate"><span class="pre">step_state()</span></code><a class="headerlink" href="#step-state" title="Link to this heading">¶</a></h3>
<p>The default <code class="docutils literal notranslate"><span class="pre">step_state()</span></code>, which can be overridden or instrumented by
exploration techniques, is also simple - it calls <code class="docutils literal notranslate"><span class="pre">successors()</span></code>, which
returns a <code class="docutils literal notranslate"><span class="pre">SimSuccessors</span></code> object, and then translates it into a dict mapping
stash names to new states which should be added to that stash. It also
implements error handling - if <code class="docutils literal notranslate"><span class="pre">successors()</span></code> throws an error, it will be
caught and an <code class="docutils literal notranslate"><span class="pre">ErrorRecord</span></code> will be inserted into
<code class="docutils literal notranslate"><span class="pre">SimulationManager.errored</span></code>.</p>
</section>
<section id="successors">
<h3><code class="docutils literal notranslate"><span class="pre">successors()</span></code><a class="headerlink" href="#successors" title="Link to this heading">¶</a></h3>
<p>We’ve almost made it out of SimulationManager. <code class="docutils literal notranslate"><span class="pre">successors()</span></code>, which can also
be instrumented by exploration techniques, is supposed to take a state and step
it forward, returning a <code class="docutils literal notranslate"><span class="pre">SimSuccessors</span></code> object categorizing its successors
independently of any stash logic. If the <code class="docutils literal notranslate"><span class="pre">successor_func</span></code> parameter was
provided, it is used and its return value is returned directly. If this
parameter was not provided, we use the <code class="docutils literal notranslate"><span class="pre">project.factory.successors</span></code> method to
tick the state forward and get our <code class="docutils literal notranslate"><span class="pre">SimSuccessors</span></code>.</p>
</section>
</section>
<section id="the-engine">
<h2>The Engine<a class="headerlink" href="#the-engine" title="Link to this heading">¶</a></h2>
<p>When we get to the actual successors generation, we need to figure out how to
actually perform the execution. Hopefully, the bisa documentation has been
organized in a way such that by the time you reach this page, you know that a
<code class="docutils literal notranslate"><span class="pre">SimEngine</span></code> is a device that knows how to take a state and produce its
successors. There is only one “default engine” per project, but you can provide
the <code class="docutils literal notranslate"><span class="pre">engine</span></code> parameter to specify which engine will be used to perform the
step.</p>
<p>Keep in mind that this parameter can be provided way at the top, to <code class="docutils literal notranslate"><span class="pre">.step()</span></code>,
<code class="docutils literal notranslate"><span class="pre">.explore()</span></code>, <code class="docutils literal notranslate"><span class="pre">.run()</span></code> or anything else that starts execution, and they will
be filtered down to this level. Any additional parameters will continue being
passed down, until they reach the part of the engine they are intended for. The
engine will discard any parameters it doesn’t understand.</p>
<p>Generally, the main entry point of an engine is <code class="docutils literal notranslate"><span class="pre">SimEngine.process()</span></code>, which
can return whatever result it likes, but for simulation managers, engines are
required to use <code class="docutils literal notranslate"><span class="pre">SuccessorsMixin</span></code>, which provides a <code class="docutils literal notranslate"><span class="pre">process()</span></code> method,
which creates a <code class="docutils literal notranslate"><span class="pre">SimSuccessors</span></code> object and then calls <code class="docutils literal notranslate"><span class="pre">process_successors()</span></code>
so that other mixins can fill it out.</p>
<p>bisa’s default engine, the <code class="docutils literal notranslate"><span class="pre">UberEngine</span></code>, contains several mixins which provide
the <code class="docutils literal notranslate"><span class="pre">process_successors()</span></code> method:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SimEngineFailure</span></code> - handles stepping states with degenerate jumpkinds</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SimEngineSyscall</span></code> - handles stepping states which have performed a syscall
and need it executed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HooksMixin</span></code> - handles stepping states which have reached a hooked address
and need the hook executed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SimEngineUnicorn</span></code> - executes machine code via the unicorn engine</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SootMixin</span></code> - executes java bytecode via the SOOT IR</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HeavyVEXMixin</span></code> - executes machine code via the VEX IR</p></li>
</ul>
<p>Each of these mixins is implemented to fill out the <code class="docutils literal notranslate"><span class="pre">SimSuccessors</span></code> object if
they can handle the current state, otherwise they call <code class="docutils literal notranslate"><span class="pre">super()</span></code> to pass the
job on to the next class in the stack.</p>
</section>
<section id="engine-mixins">
<h2>Engine mixins<a class="headerlink" href="#engine-mixins" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">SimEngineFailure</span></code> handles error cases. It is only used when the previous
jumpkind is one of <code class="docutils literal notranslate"><span class="pre">Ijk_EmFail</span></code>, <code class="docutils literal notranslate"><span class="pre">Ijk_MapFail</span></code>, <code class="docutils literal notranslate"><span class="pre">Ijk_Sig*</span></code>,
<code class="docutils literal notranslate"><span class="pre">Ijk_NoDecode</span></code> (but only if the address is not hooked), or <code class="docutils literal notranslate"><span class="pre">Ijk_Exit</span></code>. In
the first four cases, its action is to raise an exception. In the last case, its
action is to simply produce no successors.</p>
<p><code class="docutils literal notranslate"><span class="pre">SimEngineSyscall</span></code> services syscalls. It is used when the previous jumpkind is
anything of the form <code class="docutils literal notranslate"><span class="pre">Ijk_Sys*</span></code>. It works by making a call into <code class="docutils literal notranslate"><span class="pre">SimOS</span></code> to
retrieve the SimProcedure that should be run to respond to this syscall, and
then running it! Pretty simple.</p>
<p><code class="docutils literal notranslate"><span class="pre">HooksMixin</span></code> provides the hooking functionality in bisa. It is used when a
state is at an address that is hooked, and the previous jumpkind is <em>not</em>
<code class="docutils literal notranslate"><span class="pre">Ijk_NoHook</span></code>. It simply looks up the associated SimProcedure and runs it on
the state! It also takes the parameter <code class="docutils literal notranslate"><span class="pre">procedure</span></code>, which will cause the given
procedure to be run for the current step even if the address is not hooked.</p>
<p><code class="docutils literal notranslate"><span class="pre">SimEngineUnicorn</span></code> performs concrete execution with the Unicorn Engine. It is
used when the state option <code class="docutils literal notranslate"><span class="pre">o.UNICORN</span></code> is enabled, and a myriad of other
conditions designed for maximum efficiency (described below) are met.</p>
<p><code class="docutils literal notranslate"><span class="pre">SootMixin</span></code> performs execution over the SOOT IR. Not very important unless you
are analyzing java bytecode, in which case it is very important.</p>
<p><code class="docutils literal notranslate"><span class="pre">SimEngineVEX</span></code> is the big fellow. It is used whenever any of the previous
can’t be used. It attempts to lift bytes from the current address into an IRSB,
and then executes that IRSB symbolically. There are a huge number of parameters
that can control this process, so it is best to reference the API doc for
<code class="xref py py-meth docutils literal notranslate"><span class="pre">bisa.engines.vex.engine.SimEngineVEX.process()</span></code> describing them.</p>
<p>The exact process by which SimEngineVEX digs into an IRSB is a little
complicated, but essentially it runs all the block’s statements in order. This
code is worth reading if you want to see the true inner core of bisa’s symbolic
execution.</p>
</section>
<section id="when-using-unicorn-engine">
<h2>When using Unicorn Engine<a class="headerlink" href="#when-using-unicorn-engine" title="Link to this heading">¶</a></h2>
<p>If you add the <code class="docutils literal notranslate"><span class="pre">o.UNICORN</span></code> state option, at every step <code class="docutils literal notranslate"><span class="pre">SimEngineUnicorn</span></code>
will be invoked, and try to see if it is allowed to use Unicorn to execute
concretely.</p>
<p>What you REALLY want to do is to add the predefined set <code class="docutils literal notranslate"><span class="pre">o.unicorn</span></code> (lowercase) of options to your state:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">unicorn</span> <span class="o">=</span> <span class="p">{</span> <span class="n">UNICORN</span><span class="p">,</span> <span class="n">UNICORN_SYM_REGS_SUPPORT</span><span class="p">,</span> <span class="n">INITIALIZE_ZERO_REGISTERS</span><span class="p">,</span> <span class="n">UNICORN_HANDLE_TRANSMIT_SYSCALL</span> <span class="p">}</span>
</pre></div>
</div>
<p>These will enable some additional functionalities and defaults which will
greatly enhance your experience. Additionally, there are a lot of options you
can tune on the <code class="docutils literal notranslate"><span class="pre">state.unicorn</span></code> plugin.</p>
<p>A good way to understand how unicorn works is by examining the logging output (<code class="docutils literal notranslate"><span class="pre">logging.getLogger('bisa.engines.unicorn_engine').setLevel('DEBUG');</span> <span class="pre">logging.getLogger('bisa.state_plugins.unicorn_engine').setLevel('DEBUG')</span></code> from a sample run of unicorn.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INFO</span>    <span class="o">|</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">25</span> <span class="mi">08</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span><span class="mi">012</span> <span class="o">|</span> <span class="n">bisa</span><span class="o">.</span><span class="n">state_plugins</span><span class="o">.</span><span class="n">unicorn</span> <span class="o">|</span> <span class="n">started</span> <span class="n">emulation</span> <span class="n">at</span> <span class="mh">0x4012f9</span> <span class="p">(</span><span class="mi">1000000</span> <span class="n">steps</span><span class="p">)</span>
</pre></div>
</div>
<p>Here, bisa diverts to unicorn engine, beginning with the basic block at
0x4012f9. The maximum step count is set to 1000000, so if execution stays in
Unicorn for 1000000 blocks, it’ll automatically pop out. This is to avoid
hanging in an infinite loop. The block count is configurable via the
<code class="docutils literal notranslate"><span class="pre">state.unicorn.max_steps</span></code> variable.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INFO</span>    <span class="o">|</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">25</span> <span class="mi">08</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span><span class="mi">014</span> <span class="o">|</span> <span class="n">bisa</span><span class="o">.</span><span class="n">state_plugins</span><span class="o">.</span><span class="n">unicorn</span> <span class="o">|</span> <span class="n">mmap</span> <span class="p">[</span><span class="mh">0x401000</span><span class="p">,</span> <span class="mh">0x401fff</span><span class="p">],</span> <span class="mi">5</span> <span class="p">(</span><span class="n">symbolic</span><span class="p">)</span>
<span class="n">INFO</span>    <span class="o">|</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">25</span> <span class="mi">08</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span><span class="mi">016</span> <span class="o">|</span> <span class="n">bisa</span><span class="o">.</span><span class="n">state_plugins</span><span class="o">.</span><span class="n">unicorn</span> <span class="o">|</span> <span class="n">mmap</span> <span class="p">[</span><span class="mh">0x7fffffffffe0000</span><span class="p">,</span> <span class="mh">0x7fffffffffeffff</span><span class="p">],</span> <span class="mi">3</span> <span class="p">(</span><span class="n">symbolic</span><span class="p">)</span>
<span class="n">INFO</span>    <span class="o">|</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">25</span> <span class="mi">08</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span><span class="mi">019</span> <span class="o">|</span> <span class="n">bisa</span><span class="o">.</span><span class="n">state_plugins</span><span class="o">.</span><span class="n">unicorn</span> <span class="o">|</span> <span class="n">mmap</span> <span class="p">[</span><span class="mh">0x6010000</span><span class="p">,</span> <span class="mh">0x601ffff</span><span class="p">],</span> <span class="mi">3</span>
<span class="n">INFO</span>    <span class="o">|</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">25</span> <span class="mi">08</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span><span class="mi">022</span> <span class="o">|</span> <span class="n">bisa</span><span class="o">.</span><span class="n">state_plugins</span><span class="o">.</span><span class="n">unicorn</span> <span class="o">|</span> <span class="n">mmap</span> <span class="p">[</span><span class="mh">0x602000</span><span class="p">,</span> <span class="mh">0x602fff</span><span class="p">],</span> <span class="mi">3</span> <span class="p">(</span><span class="n">symbolic</span><span class="p">)</span>
<span class="n">INFO</span>    <span class="o">|</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">25</span> <span class="mi">08</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span><span class="mi">023</span> <span class="o">|</span> <span class="n">bisa</span><span class="o">.</span><span class="n">state_plugins</span><span class="o">.</span><span class="n">unicorn</span> <span class="o">|</span> <span class="n">mmap</span> <span class="p">[</span><span class="mh">0x400000</span><span class="p">,</span> <span class="mh">0x400fff</span><span class="p">],</span> <span class="mi">5</span>
<span class="n">INFO</span>    <span class="o">|</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">25</span> <span class="mi">08</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span><span class="mi">025</span> <span class="o">|</span> <span class="n">bisa</span><span class="o">.</span><span class="n">state_plugins</span><span class="o">.</span><span class="n">unicorn</span> <span class="o">|</span> <span class="n">mmap</span> <span class="p">[</span><span class="mh">0x7000000</span><span class="p">,</span> <span class="mh">0x7000fff</span><span class="p">],</span> <span class="mi">5</span>
</pre></div>
</div>
<p>bisa performs lazy mapping of data that is accessed by unicorn engine, as it is
accessed. 0x401000 is the page of instructions that it is executing,
0x7fffffffffe0000 is the stack, and so on. Some of these pages are symbolic,
meaning that they contain at least some data that, when accessed, will cause
execution to abort out of Unicorn.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INFO</span>    <span class="o">|</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">25</span> <span class="mi">08</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span><span class="mi">037</span> <span class="o">|</span> <span class="n">bisa</span><span class="o">.</span><span class="n">state_plugins</span><span class="o">.</span><span class="n">unicorn</span> <span class="o">|</span> <span class="n">finished</span> <span class="n">emulation</span> <span class="n">at</span> <span class="mh">0x7000080</span> <span class="n">after</span> <span class="mi">3</span> <span class="n">steps</span><span class="p">:</span> <span class="n">STOP_STOPPOINT</span>
</pre></div>
</div>
<p>Execution stays in Unicorn for 3 basic blocks (a computational waste,
considering the required setup), after which it reaches a simprocedure location
and jumps out to execute the simproc in bisa.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INFO</span>    <span class="o">|</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">25</span> <span class="mi">08</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span><span class="mi">076</span> <span class="o">|</span> <span class="n">bisa</span><span class="o">.</span><span class="n">state_plugins</span><span class="o">.</span><span class="n">unicorn</span> <span class="o">|</span> <span class="n">started</span> <span class="n">emulation</span> <span class="n">at</span> <span class="mh">0x40175d</span> <span class="p">(</span><span class="mi">1000000</span> <span class="n">steps</span><span class="p">)</span>
<span class="n">INFO</span>    <span class="o">|</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">25</span> <span class="mi">08</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span><span class="mi">077</span> <span class="o">|</span> <span class="n">bisa</span><span class="o">.</span><span class="n">state_plugins</span><span class="o">.</span><span class="n">unicorn</span> <span class="o">|</span> <span class="n">mmap</span> <span class="p">[</span><span class="mh">0x401000</span><span class="p">,</span> <span class="mh">0x401fff</span><span class="p">],</span> <span class="mi">5</span> <span class="p">(</span><span class="n">symbolic</span><span class="p">)</span>
<span class="n">INFO</span>    <span class="o">|</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">25</span> <span class="mi">08</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span><span class="mi">079</span> <span class="o">|</span> <span class="n">bisa</span><span class="o">.</span><span class="n">state_plugins</span><span class="o">.</span><span class="n">unicorn</span> <span class="o">|</span> <span class="n">mmap</span> <span class="p">[</span><span class="mh">0x7fffffffffe0000</span><span class="p">,</span> <span class="mh">0x7fffffffffeffff</span><span class="p">],</span> <span class="mi">3</span> <span class="p">(</span><span class="n">symbolic</span><span class="p">)</span>
<span class="n">INFO</span>    <span class="o">|</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">25</span> <span class="mi">08</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span><span class="mi">081</span> <span class="o">|</span> <span class="n">bisa</span><span class="o">.</span><span class="n">state_plugins</span><span class="o">.</span><span class="n">unicorn</span> <span class="o">|</span> <span class="n">mmap</span> <span class="p">[</span><span class="mh">0x6010000</span><span class="p">,</span> <span class="mh">0x601ffff</span><span class="p">],</span> <span class="mi">3</span>
</pre></div>
</div>
<p>After the simprocedure, execution jumps back into Unicorn.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WARNING</span> <span class="o">|</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">25</span> <span class="mi">08</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span><span class="mi">082</span> <span class="o">|</span> <span class="n">bisa</span><span class="o">.</span><span class="n">state_plugins</span><span class="o">.</span><span class="n">unicorn</span> <span class="o">|</span> <span class="n">fetching</span> <span class="n">empty</span> <span class="n">page</span> <span class="p">[</span><span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xfff</span><span class="p">]</span>
<span class="n">INFO</span>    <span class="o">|</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">25</span> <span class="mi">08</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span><span class="mi">103</span> <span class="o">|</span> <span class="n">bisa</span><span class="o">.</span><span class="n">state_plugins</span><span class="o">.</span><span class="n">unicorn</span> <span class="o">|</span> <span class="n">finished</span> <span class="n">emulation</span> <span class="n">at</span> <span class="mh">0x401777</span> <span class="n">after</span> <span class="mi">1</span> <span class="n">steps</span><span class="p">:</span> <span class="n">STOP_EXECNONE</span>
</pre></div>
</div>
<p>Execution bounces out of Unicorn almost right away because the binary accessed
the zero-page.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INFO</span>    <span class="o">|</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">25</span> <span class="mi">08</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span><span class="mi">120</span> <span class="o">|</span> <span class="n">bisa</span><span class="o">.</span><span class="n">engines</span><span class="o">.</span><span class="n">unicorn_engine</span> <span class="o">|</span> <span class="ow">not</span> <span class="n">enough</span> <span class="n">runs</span> <span class="n">since</span> <span class="n">last</span> <span class="n">unicorn</span> <span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">INFO</span>    <span class="o">|</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">25</span> <span class="mi">08</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span><span class="mi">125</span> <span class="o">|</span> <span class="n">bisa</span><span class="o">.</span><span class="n">engines</span><span class="o">.</span><span class="n">unicorn_engine</span> <span class="o">|</span> <span class="ow">not</span> <span class="n">enough</span> <span class="n">runs</span> <span class="n">since</span> <span class="n">last</span> <span class="n">unicorn</span> <span class="p">(</span><span class="mi">99</span><span class="p">)</span>
</pre></div>
</div>
<p>To avoid thrashing in and out of Unicorn (which is expensive), we have cooldowns
(attributes of the <code class="docutils literal notranslate"><span class="pre">state.unicorn</span></code> plugin) that wait for certain conditions to
hold (i.e., no symbolic memory accesses for X blocks) before jumping back into
unicorn when a unicorn run is aborted due to anything but a simprocedure or
syscall. Here, the condition it’s waiting for is for 100 blocks to be executed
before jumping back in.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">bisa</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-concepts/index.html">Core Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analyses/index.html">Build-in Analyses</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Advanced Topics</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="gotchas.html">Gotchas when using bisa</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Understanding the Execution Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="mixins.html">What’s Up With Mixins, Anyway?</a></li>
<li class="toctree-l2"><a class="reference internal" href="speed.html">Optimization considerations</a></li>
<li class="toctree-l2"><a class="reference internal" href="file_system.html">Working with File System, Sockets, and Pipes</a></li>
<li class="toctree-l2"><a class="reference internal" href="ir.html">Intermediate Representation</a></li>
<li class="toctree-l2"><a class="reference internal" href="structured_data.html">Working with Data and Conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="claripy.html">Solver Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="concretization_strategies.html">Symbolic memory addressing</a></li>
<li class="toctree-l2"><a class="reference internal" href="java_support.html">Java Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="symbion.html">Symbion: Interleaving symbolic and concrete execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="debug_var.html">Debug variable resolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="debug_var.html#variable-visibility">Variable visibility</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../extending-bisa/index.html">Extending bisa</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">bisa examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/index.html">Appendix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Advanced Topics</a><ul>
      <li>Previous: <a href="gotchas.html" title="previous chapter">Gotchas when using bisa</a></li>
      <li>Next: <a href="mixins.html" title="next chapter">What’s Up With Mixins, Anyway?</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, The bisa Project contributors.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/advanced-topics/pipeline.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>